generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// Medical disciplines/specialties (Cardiology, Ophthalmology, etc.)
model Discipline {
  id                String                    @id @default(uuid())
  /// Medical specialty name (e.g., "Cardiology", "Ophthalmology")
  name              String
  /// URL-friendly identifier
  slug              String                    @unique
  /// Detailed description of the medical specialty
  description       String?
  /// Standard medical specialty code (ICD-10, SNOMED, or custom)
  specialtyCode     String?                   @unique @map("specialty_code")
  /// Required certifications for this specialty
  certificationReqs String?                   @map("certification_requirements")
  /// Color code for UI theming (hex color)
  colorCode         String?                   @map("color_code")
  /// Icon identifier for UI display
  iconCode          String?                   @map("icon_code")
  /// Display order in listings
  sortOrder         Int                       @default(0) @map("sort_order")
  /// Whether this discipline is active
  isActive          Boolean                   @default(true) @map("is_active")
  /// Whether to feature prominently
  isFeatured        Boolean                   @default(false) @map("is_featured")
  /// SEO meta title
  metaTitle         String?                   @map("meta_title")
  /// SEO meta description
  metaDescription   String?                   @map("meta_description")
  /// Primary image URL for discipline
  imageUrl          String?                   @map("image_url")
  createdAt         DateTime                  @default(now()) @map("created_at")
  updatedAt         DateTime                  @updatedAt @map("updated_at")
  
  // Relationships
  translations      DisciplineTranslation[]
  categories        Category[]
  products          Product[]                 @relation("DisciplineProducts")

  @@index([slug])
  @@index([specialtyCode])
  @@index([isActive, sortOrder])
  @@index([isFeatured, isActive])
  @@map("disciplines")
}

/// Multi-language support for disciplines
model DisciplineTranslation {
  id              String     @id @default(uuid())
  disciplineId    String     @map("discipline_id")
  languageCode    String     @map("language_code") // 'fr', 'en'
  name            String
  description     String?
  metaTitle       String?    @map("meta_title")
  metaDescription String?    @map("meta_description")
  
  discipline      Discipline @relation(fields: [disciplineId], references: [id], onDelete: Cascade)

  @@unique([disciplineId, languageCode])
  @@index([languageCode])
  @@map("discipline_translations")
}

/// Equipment categories within medical disciplines
model Category {
  id              String                @id @default(uuid())
  /// Category name (e.g., "Monitors", "Surgical Tools")
  name            String
  /// URL-friendly identifier
  slug            String                @unique
  /// Detailed description of equipment category
  description     String?
  /// Parent discipline this category belongs to
  disciplineId    String                @map("discipline_id")
  /// Parent category for hierarchical structure (optional)
  parentId        String?               @map("parent_id")
  /// Equipment classification level (1=main category, 2=subcategory, etc.)
  level           Int                   @default(1)
  /// Display order within discipline/parent
  sortOrder       Int                   @default(0) @map("sort_order")
  /// Whether category is active
  isActive        Boolean               @default(true) @map("is_active")
  /// Whether to feature prominently
  isFeatured      Boolean               @default(false) @map("is_featured")
  /// SEO meta title
  metaTitle       String?               @map("meta_title")
  /// SEO meta description
  metaDescription String?               @map("meta_description")
  /// Primary image URL for category
  imageUrl        String?               @map("image_url")
  /// Equipment safety classification (Class I, II, III for medical devices)
  safetyClass     String?               @map("safety_class")
  /// FDA/CE regulatory requirements
  regulatoryNotes String?               @map("regulatory_notes")
  createdAt       DateTime              @default(now()) @map("created_at")
  updatedAt       DateTime              @updatedAt @map("updated_at")
  
  // Relationships
  discipline      Discipline            @relation(fields: [disciplineId], references: [id])
  parent          Category?             @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children        Category[]            @relation("CategoryHierarchy")
  translations    CategoryTranslation[]
  products        Product[]

  @@index([slug])
  @@index([disciplineId, isActive])
  @@index([disciplineId, sortOrder])
  @@index([parentId, sortOrder])
  @@index([level, isActive])
  @@index([isFeatured, isActive])
  @@map("categories")
}

/// Multi-language support for categories
model CategoryTranslation {
  id              String   @id @default(uuid())
  categoryId      String   @map("category_id")
  languageCode    String   @map("language_code") // 'fr', 'en'
  name            String
  description     String?
  metaTitle       String?  @map("meta_title")
  metaDescription String?  @map("meta_description")
  
  category        Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, languageCode])
  @@index([languageCode])
  @@map("category_translations")
}

/// Enhanced Product model with discipline relationship
model Product {
  id                   String               @id @default(uuid())
  /// Supplier reference number
  referenceFournisseur String               @unique @map("reference_fournisseur")
  /// Primary category this product belongs to
  categoryId           String               @map("category_id")
  /// Medical discipline this product serves (derived from category but can be overridden)
  disciplineId         String               @map("discipline_id")
  /// Manufacturing/supply partner
  partnerId            String?              @map("partner_id")
  /// Manufacturer name
  constructeur         String
  /// URL-friendly identifier
  slug                 String               @unique
  /// Product lifecycle status
  status               String               @default("active") // active, discontinued, pending
  /// Whether to feature prominently
  isFeatured           Boolean              @default(false) @map("is_featured")
  /// Display order in listings
  sortOrder            Int                  @default(0) @map("sort_order")
  /// SEO meta title
  metaTitle            String?              @map("meta_title")
  /// SEO meta description
  metaDescription      String?              @map("meta_description")
  /// PDF brochure file URL
  pdfBrochureUrl       String?              @map("pdf_brochure_url")
  /// Medical device classification
  deviceClass          String?              @map("device_class") // Class I, II, III
  /// FDA/CE certification numbers
  certificationNumbers String[]             @map("certification_numbers")
  /// Warranty period in months
  warrantyMonths       Int?                 @map("warranty_months")
  /// Maintenance requirements level
  maintenanceLevel     String?              @map("maintenance_level") // low, medium, high
  /// Installation complexity
  installationLevel    String?              @map("installation_level") // simple, complex, specialist
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  
  // Relationships
  category             Category             @relation(fields: [categoryId], references: [id])
  discipline           Discipline           @relation("DisciplineProducts", fields: [disciplineId], references: [id])
  partner              Partner?             @relation(fields: [partnerId], references: [id])
  attributes           ProductAttribute[]
  media                ProductMedia[]
  translations         ProductTranslation[]
  rfpItems             RFPItem[]
  productFiles         ProductFile[]

  @@index([categoryId, isActive])
  @@index([disciplineId, isActive])
  @@index([status, isFeatured])
  @@index([constructeur])
  @@index([deviceClass])
  @@map("products")
}

/// Product translations remain the same
model ProductTranslation {
  id              String  @id @default(uuid())
  productId       String  @map("product_id")
  languageCode    String  @map("language_code")
  nom             String
  description     String?
  ficheTechnique  String? @map("fiche_technique")
  metaTitle       String? @map("meta_title")
  metaDescription String? @map("meta_description")
  product         Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, languageCode])
  @@map("product_translations")
}

/// All other models remain the same...
model ProductMedia {
  id        String   @id @default(uuid())
  productId String   @map("product_id")
  type      String
  url       String
  altText   String?  @map("alt_text")
  title     String?
  sortOrder Int      @default(0) @map("sort_order")
  isPrimary Boolean  @default(false) @map("is_primary")
  createdAt DateTime @default(now()) @map("created_at")
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_media")
}

model ProductAttribute {
  id        String  @id @default(uuid())
  productId String  @map("product_id")
  name      String
  value     String
  type      String  @default("text")
  sortOrder Int     @default(0) @map("sort_order")
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_attributes")
}

model RFPRequest {
  id                     String    @id @default(uuid())
  referenceNumber        String    @unique @map("reference_number")
  status                 String    @default("pending")
  customerName           String    @map("customer_name")
  customerEmail          String    @map("customer_email")
  customerPhone          String?   @map("customer_phone")
  companyName            String?   @map("company_name")
  companyAddress         String?   @map("company_address")
  contactPerson          String?   @map("contact_person")
  message                String?
  urgencyLevel           String    @default("normal") @map("urgency_level")
  preferredContactMethod String    @default("email") @map("preferred_contact_method")
  assignedTo             String?   @map("assigned_to")
  notes                  String?
  quoteAmount            Float?    @map("quote_amount")
  quoteValidUntil        DateTime? @map("quote_valid_until")
  createdAt              DateTime  @default(now()) @map("created_at")
  updatedAt              DateTime  @updatedAt @map("updated_at")
  items                  RFPItem[]

  @@map("rfp_requests")
}

model RFPItem {
  id                  String     @id @default(uuid())
  rfpId               String     @map("rfp_id")
  productId           String     @map("product_id")
  quantity            Int        @default(1)
  specialRequirements String?    @map("special_requirements")
  quotedPrice         Float?     @map("quoted_price")
  createdAt           DateTime   @default(now()) @map("created_at")
  product             Product    @relation(fields: [productId], references: [id])
  rfp                 RFPRequest @relation(fields: [rfpId], references: [id], onDelete: Cascade)

  @@map("rfp_items")
}

model Partner {
  id           String               @id @default(uuid())
  name         String
  slug         String               @unique
  description  String?
  websiteUrl   String?              @map("website_url")
  logoUrl      String?              @map("logo_url")
  type         String               @default("manufacturer") // manufacturer, distributor, service, technology
  isFeatured   Boolean              @default(false) @map("is_featured")
  sortOrder    Int                  @default(0) @map("sort_order")
  status       String               @default("active")
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  translations PartnerTranslation[]
  products     Product[]

  @@map("partners")
}

model PartnerTranslation {
  id           String  @id @default(uuid())
  partnerId    String  @map("partner_id")
  languageCode String  @map("language_code")
  name         String
  description  String?
  partner      Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, languageCode])
  @@map("partner_translations")
}

model Page {
  id              String            @id @default(uuid())
  slug            String            @unique
  title           String
  content         String?
  status          String            @default("published")
  metaTitle       String?           @map("meta_title")
  metaDescription String?           @map("meta_description")
  isHomepage      Boolean           @default(false) @map("is_homepage")
  sortOrder       Int               @default(0) @map("sort_order")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  translations    PageTranslation[]

  @@map("pages")
}

model PageTranslation {
  id              String  @id @default(uuid())
  pageId          String  @map("page_id")
  languageCode    String  @map("language_code")
  title           String
  content         String?
  metaTitle       String? @map("meta_title")
  metaDescription String? @map("meta_description")
  page            Page    @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([pageId, languageCode])
  @@map("page_translations")
}

model Banner {
  id             String              @id @default(uuid())
  title          String
  subtitle       String?
  description    String?
  imageUrl       String?             @map("image_url")
  backgroundUrl  String?             @map("background_url")
  ctaText        String?             @map("cta_text")
  ctaUrl         String?             @map("cta_url")
  ctaStyle       String              @default("primary") @map("cta_style")
  position       String              @default("homepage")
  layout         String              @default("split")
  textAlign      String              @default("left") @map("text_align")
  overlayOpacity Float               @default(0.9) @map("overlay_opacity")
  sortOrder      Int                 @default(0) @map("sort_order")
  isActive       Boolean             @default(true) @map("is_active")
  startDate      DateTime?           @map("start_date")
  endDate        DateTime?           @map("end_date")
  createdAt      DateTime            @default(now()) @map("created_at")
  updatedAt      DateTime            @updatedAt @map("updated_at")
  translations   BannerTranslation[]

  @@map("banners")
}

model BannerTranslation {
  id           String  @id @default(uuid())
  bannerId     String  @map("banner_id")
  languageCode String  @map("language_code")
  title        String
  subtitle     String?
  description  String?
  ctaText      String? @map("cta_text")
  banner       Banner  @relation(fields: [bannerId], references: [id], onDelete: Cascade)

  @@unique([bannerId, languageCode])
  @@map("banner_translations")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  passwordHash  String         @map("password_hash")
  firstName     String         @map("first_name")
  lastName      String         @map("last_name")
  role          String         @default("editor")
  isActive      Boolean        @default(true) @map("is_active")
  lastLogin     DateTime?      @map("last_login")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  activityLogs  ActivityLog[]
  sessions      UserSession[]
  notifications Notification[]

  @@map("users")
}

model UserSession {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_sessions")
}

model ActivityLog {
  id           String   @id @default(uuid())
  userId       String?  @map("user_id")
  action       String
  resourceType String   @map("resource_type")
  resourceId   String?  @map("resource_id")
  details      Json?
  ipAddress    String?  @map("ip_address")
  userAgent    String?  @map("user_agent")
  createdAt    DateTime @default(now()) @map("created_at")
  user         User?    @relation(fields: [userId], references: [id])

  @@map("activity_logs")
}

model PageView {
  id        String   @id @default(uuid())
  pagePath  String   @map("page_path")
  referrer  String?
  userAgent String?  @map("user_agent")
  ipAddress String?  @map("ip_address")
  sessionId String?  @map("session_id")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("page_views")
}

model Notification {
  id             String    @id @default(uuid())
  type           String    // rfp, inventory, product, user, system, security
  priority       String    // low, medium, high, critical
  title          String
  message        String
  data           Json?
  userId         String?   @map("user_id")
  read           Boolean   @default(false)
  actionRequired Boolean   @default(false) @map("action_required")
  actionUrl      String?   @map("action_url")
  expiresAt      DateTime? @map("expires_at")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  user           User?     @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model FileRegistry {
  id            String        @id @default(uuid())
  originalUrl   String        @map("original_url")
  urlHash       String        @unique @map("url_hash") // SHA-256 hash of URL
  contentHash   String        @map("content_hash") // SHA-256 hash of file content
  localPath     String        @map("local_path") // Relative path from public/
  filename      String        
  mimeType      String        @map("mime_type")
  fileSize      Int           @map("file_size") // Size in bytes
  fileType      String        @map("file_type") // pdf, image, document
  downloadedAt  DateTime      @default(now()) @map("downloaded_at")
  lastAccessedAt DateTime     @default(now()) @map("last_accessed_at")
  accessCount   Int           @default(1) @map("access_count")
  isOrphaned    Boolean       @default(false) @map("is_orphaned") // No products reference this file
  productFiles  ProductFile[]

  @@index([urlHash])
  @@index([contentHash])
  @@index([fileType])
  @@index([isOrphaned])
  @@map("file_registry")
}

model ProductFile {
  id           String       @id @default(uuid())
  productId    String       @map("product_id")
  fileId       String       @map("file_id")
  fileType     String       @map("file_type") // pdf_brochure, product_image
  sortOrder    Int          @default(0) @map("sort_order")
  isPrimary    Boolean      @default(false) @map("is_primary") // For images
  altText      String?      @map("alt_text")
  title        String?      
  description  String?
  createdAt    DateTime     @default(now()) @map("created_at")
  product      Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  file         FileRegistry @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@unique([productId, fileId, fileType])
  @@index([productId])
  @@index([fileId])
  @@index([fileType])
  @@map("product_files")
}