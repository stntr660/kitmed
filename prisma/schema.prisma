generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model activity_logs {
  id            String   @id
  user_id       String?
  action        String
  resource_type String
  resource_id   String?
  details       Json?
  ip_address    String?
  user_agent    String?
  created_at    DateTime @default(now())
  users         users?   @relation(fields: [user_id], references: [id])
}

model banner_translations {
  id            String  @id
  banner_id     String
  language_code String
  title         String
  subtitle      String?
  description   String?
  cta_text      String?
  banners       banners @relation(fields: [banner_id], references: [id], onDelete: Cascade)

  @@unique([banner_id, language_code])
}

model banners {
  id                  String                @id
  title               String
  subtitle            String?
  description         String?
  image_url           String?
  background_url      String?
  cta_text            String?
  cta_url             String?
  cta_style           String                @default("primary")
  position            String                @default("homepage")
  layout              String                @default("split")
  text_align          String                @default("left")
  overlay_opacity     Float                 @default(0.9)
  sort_order          Int                   @default(0)
  is_active           Boolean               @default(true)
  start_date          DateTime?
  end_date            DateTime?
  created_at          DateTime              @default(now())
  updated_at          DateTime
  banner_translations banner_translations[]
}

model categories {
  id                    String                  @id
  name                  String
  slug                  String                  @unique
  description           String?
  parent_id             String?
  sort_order            Int                     @default(0)
  is_active             Boolean                 @default(true)
  meta_title            String?
  meta_description      String?
  image_url             String?
  created_at            DateTime                @default(now())
  updated_at            DateTime
  type                  String                  @default("discipline")
  categories            categories?             @relation("categoriesTocategories", fields: [parent_id], references: [id])
  other_categories      categories[]            @relation("categoriesTocategories")
  category_translations category_translations[]
  products              products[]
}

model category_translations {
  id               String     @id
  category_id      String
  language_code    String
  name             String
  description      String?
  meta_title       String?
  meta_description String?
  categories       categories @relation(fields: [category_id], references: [id], onDelete: Cascade)

  @@unique([category_id, language_code])
}

model file_registry {
  id               String          @id
  original_url     String
  url_hash         String          @unique
  content_hash     String
  local_path       String
  filename         String
  mime_type        String
  file_size        Int
  file_type        String
  downloaded_at    DateTime        @default(now())
  last_accessed_at DateTime        @default(now())
  access_count     Int             @default(1)
  is_orphaned      Boolean         @default(false)
  product_files    product_files[]

  @@index([content_hash])
  @@index([file_type])
  @@index([is_orphaned])
  @@index([url_hash])
}

model notifications {
  id              String    @id
  type            String
  priority        String
  title           String
  message         String
  data            Json?
  user_id         String?
  read            Boolean   @default(false)
  action_required Boolean   @default(false)
  action_url      String?
  expires_at      DateTime?
  created_at      DateTime  @default(now())
  updated_at      DateTime
  users           users?    @relation(fields: [user_id], references: [id])
}

model page_translations {
  id               String  @id
  page_id          String
  language_code    String
  title            String
  content          String?
  meta_title       String?
  meta_description String?
  pages            pages   @relation(fields: [page_id], references: [id], onDelete: Cascade)

  @@unique([page_id, language_code])
}

model page_views {
  id         String   @id
  page_path  String
  referrer   String?
  user_agent String?
  ip_address String?
  session_id String?
  created_at DateTime @default(now())
}

model pages {
  id                String              @id
  slug              String              @unique
  title             String
  content           String?
  status            String              @default("published")
  meta_title        String?
  meta_description  String?
  is_homepage       Boolean             @default(false)
  sort_order        Int                 @default(0)
  created_at        DateTime            @default(now())
  updated_at        DateTime
  page_translations page_translations[]
}

model partner_translations {
  id            String   @id
  partner_id    String
  language_code String
  name          String
  description   String?
  partners      partners @relation(fields: [partner_id], references: [id], onDelete: Cascade)

  @@unique([partner_id, language_code])
}

model partners {
  id                   String                 @id
  name                 String
  slug                 String                 @unique
  description          String?
  website_url          String?
  logo_url             String?
  default_pdf_url      String?
  type                 String                 @default("manufacturer")
  is_featured          Boolean                @default(false)
  sort_order           Int                    @default(0)
  status               String                 @default("active")
  created_at           DateTime               @default(now())
  updated_at           DateTime
  partner_translations partner_translations[]
  products             products[]
}

model product_attributes {
  id         String   @id
  product_id String
  name       String
  value      String
  type       String   @default("text")
  sort_order Int      @default(0)
  products   products @relation(fields: [product_id], references: [id], onDelete: Cascade)
}

model product_files {
  id            String        @id
  product_id    String
  file_id       String
  file_type     String
  sort_order    Int           @default(0)
  is_primary    Boolean       @default(false)
  alt_text      String?
  title         String?
  description   String?
  created_at    DateTime      @default(now())
  file_registry file_registry @relation(fields: [file_id], references: [id], onDelete: Cascade)
  products      products      @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@unique([product_id, file_id, file_type])
  @@index([file_id])
  @@index([file_type])
  @@index([product_id])
}

model product_media {
  id         String   @id
  product_id String
  type       String
  url        String
  alt_text   String?
  title      String?
  sort_order Int      @default(0)
  is_primary Boolean  @default(false)
  created_at DateTime @default(now())
  products   products @relation(fields: [product_id], references: [id], onDelete: Cascade)
}

model product_translations {
  id               String   @id
  product_id       String
  language_code    String
  nom              String
  description      String?
  fiche_technique  String?
  meta_title       String?
  meta_description String?
  products         products @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@unique([product_id, language_code])
}

model products {
  id                    String                 @id
  reference_fournisseur String                 @unique
  category_id           String
  constructeur          String
  slug                  String                 @unique
  status                String                 @default("active")
  is_featured           Boolean                @default(false)
  sort_order            Int                    @default(0)
  meta_title            String?
  meta_description      String?
  pdf_brochure_url      String?
  created_at            DateTime               @default(now())
  updated_at            DateTime
  partner_id            String?
  product_attributes    product_attributes[]
  product_files         product_files[]
  product_media         product_media[]
  product_translations  product_translations[]
  categories            categories             @relation(fields: [category_id], references: [id])
  partners              partners?              @relation(fields: [partner_id], references: [id])
  rfp_items             rfp_items[]
}

model rfp_items {
  id                   String       @id
  rfp_id               String
  product_id           String
  quantity             Int          @default(1)
  special_requirements String?
  quoted_price         Float?
  created_at           DateTime     @default(now())
  products             products     @relation(fields: [product_id], references: [id])
  rfp_requests         rfp_requests @relation(fields: [rfp_id], references: [id], onDelete: Cascade)
}

model rfp_requests {
  id                       String      @id
  reference_number         String      @unique
  status                   String      @default("pending")
  customer_name            String
  customer_email           String
  customer_phone           String?
  company_name             String?
  company_address          String?
  contact_person           String?
  message                  String?
  urgency_level            String      @default("normal")
  preferred_contact_method String      @default("email")
  assigned_to              String?
  notes                    String?
  quote_amount             Float?
  quote_valid_until        DateTime?
  created_at               DateTime    @default(now())
  updated_at               DateTime
  rfp_items                rfp_items[]
}

model user_sessions {
  id         String   @id
  user_id    String
  token      String   @unique
  expires_at DateTime
  created_at DateTime @default(now())
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model users {
  id            String          @id
  email         String          @unique
  password_hash String
  first_name    String
  last_name     String
  role          String          @default("editor")
  is_active     Boolean         @default(true)
  last_login    DateTime?
  created_at    DateTime        @default(now())
  updated_at    DateTime
  activity_logs activity_logs[]
  notifications notifications[]
  user_sessions user_sessions[]
}
